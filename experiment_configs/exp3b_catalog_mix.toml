# Experiment 3b: Catalog Latency Sweep (90/10 FastAppend/ValidatedOverwrite Mix)
#
# Goal: Determine catalog latency impact when maintenance operations are present.
#
# Catalog CAS latency sweep: [1, 5, 10, 20, 50, 80, 120] ms
#   Notable provider min_latency values in this range:
#     1ms ~ instant, 10ms ~ S3 Express, 40-43ms ~ Azure Premium/S3, 118ms ~ GCP
#
# Arrival rate sweep: same as exp1/exp2 (LOAD_SWEEP)
#
# Operation types: 90% FastAppend, 10% ValidatedOverwrite
# Real conflict probability: 0.0 (isolates catalog latency + operation-type cost)
#
# Expected patterns:
#   - VO success rate degrades more than FA as catalog latency increases
#   - Higher catalog latency -> more time for txns to commit -> higher n_behind -> larger I/O convoy
#   - Compare to Exp 3a: mixed workload more sensitive to catalog latency
#
# Validation:
#   - Operation type distribution matches ~90/10 (within sampling variance)
#   - No validation_exception aborts (all aborts from max_retries_exceeded)
#   - Clear ordering of throughput: instant > s3x > azure_premium > s3 > gcp

[simulation]
duration_ms = 3600000  # 1 hour
output_path = "results.parquet"

[experiment]
label = "exp3b_catalog_mix"

[catalog]
num_tables = 1
num_groups = 1
table_metadata_inlined = true
backend = "service"

[catalog.service]
provider = "instant"
latency_ms = 1.0  # Swept parameter (replaces storage.provider sweep)

[transaction]
retry = 10
runtime.min = 30000
runtime.mean = 180000
runtime.sigma = 1.5

inter_arrival.distribution = "exponential"
inter_arrival.scale = 100.0  # Swept parameter

# 90% FastAppend, 10% ValidatedOverwrite (realistic mixed workload)
operation_types.fast_append = 0.9
operation_types.validated_overwrite = 0.1

# No real conflicts â€” isolates catalog latency + operation-type cost
real_conflict_probability = 0.0

conflicting_manifests.distribution = "exponential"
conflicting_manifests.mean = 3.0
conflicting_manifests.min = 1
conflicting_manifests.max = 10
manifest_list_mode = "rewrite"

[storage]
provider = "s3"  # Fixed S3 storage (catalog latency swept separately)
max_parallel = 4

[plots]
output_dir = "plots/exp3b_catalog_mix"

[[plots.graphs]]
type = "commit_rate_over_time"

[[plots.graphs]]
type = "heatmap"
x_param = "inter_arrival_scale"
y_param = "catalog_service_latency_ms"
metrics = ["success_rate", "throughput", "mean_latency", "p99_latency"]
per_type_metrics = ["success_rate", "mean_latency"]

[[plots.graphs]]
type = "operation_types"
group_by = "catalog_service_latency_ms"
